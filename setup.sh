#!/bin/bash
# Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ø¨ÙˆØª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®Ø·ÙŠØ·

echo "ğŸ¢ Ø¨ÙˆØª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®Ø·ÙŠØ· - Ø´Ø±ÙƒØ© Ø§Ù„Ø¨Ø±ÙŠÙ‚Ø©"
echo "========================================="
echo ""

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Python
echo "ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Python..."
if ! command -v python3 &> /dev/null; then
    echo "âŒ Python ØºÙŠØ± Ù…Ø«Ø¨Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ«Ø¨ÙŠØª Python 3.8 Ø£Ùˆ Ø£Ø­Ø¯Ø«"
    exit 1
fi

PYTHON_VERSION=$(python3 --version | cut -d' ' -f2 | cut -d'.' -f1,2)
echo "âœ… Python $PYTHON_VERSION Ù…ÙˆØ¬ÙˆØ¯"

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† pip
echo ""
echo "ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† pip..."
if ! command -v pip3 &> /dev/null; then
    echo "âŒ pip ØºÙŠØ± Ù…Ø«Ø¨Øª"
    exit 1
fi
echo "âœ… pip Ù…ÙˆØ¬ÙˆØ¯"

# ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
echo ""
echo "ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©..."
pip3 install -r requirements.txt
if [ $? -ne 0 ]; then
    echo "âŒ ÙØ´Ù„ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª"
    exit 1
fi
echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­"

# Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±ÙØ¹
echo ""
echo "ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª..."
mkdir -p uploads
echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ uploads"

# Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .env Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
if [ ! -f .env ]; then
    echo ""
    echo "âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª..."
    cp .env.example .env
    echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .env"
    echo ""
    echo "âš ï¸  ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø±ÙŠØ± Ù…Ù„Ù .env ÙˆØ¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª"
    echo "   ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† @BotFather Ø¹Ù„Ù‰ ØªÙ„ÙŠØºØ±Ø§Ù…"
    echo ""
    read -p "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø¢Ù†ØŸ (y/n): " answer
    if [ "$answer" = "y" ] || [ "$answer" = "Y" ]; then
        read -p "Ø£Ø¯Ø®Ù„ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª: " token
        sed -i "s/YOUR_BOT_TOKEN_HERE/$token/" .env
        echo "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ†"
    fi
else
    echo ""
    echo "âœ… Ù…Ù„Ù .env Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹"
fi

# ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
echo ""
echo "ğŸ—„ï¸ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."
python3 database.py
if [ $? -ne 0 ]; then
    echo "âŒ ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
    exit 1
fi
echo "âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­"

# Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªØ´ØºÙŠÙ„
echo ""
echo "ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªØ´ØºÙŠÙ„..."
cat > run.sh << 'EOF'
#!/bin/bash
echo "ğŸ¤– ØªØ´ØºÙŠÙ„ Ø¨ÙˆØª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®Ø·ÙŠØ·..."
python3 main.py
EOF

chmod +x run.sh
echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ run.sh"

# Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
echo ""
echo "========================================="
echo "âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ù†Ø¬Ø§Ø­!"
echo "========================================="
echo ""
echo "ğŸ“ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:"
echo ""
echo "1. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª ÙÙŠ Ù…Ù„Ù .env"
echo "   nano .env"
echo ""
echo "2. Ø´ØºÙ„ Ø§Ù„Ø¨ÙˆØª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…:"
echo "   ./run.sh"
echo "   Ø£Ùˆ"
echo "   python3 main.py"
echo ""
echo "3. Ø§ÙØªØ­ Ø§Ù„Ø¨ÙˆØª Ø¹Ù„Ù‰ ØªÙ„ÙŠØºØ±Ø§Ù… ÙˆØ§Ø¨Ø¯Ø£ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡!"
echo ""
echo "ğŸ“š Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ Ø§Ù‚Ø±Ø£ Ù…Ù„Ù README.md"
echo ""
